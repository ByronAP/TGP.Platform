@page "/Tenants"
@model TGP.AdminPortal.Pages.Tenants.IndexModel
@{
    ViewData["Title"] = "Tenants";
}

<div class="card">
    <div class="card-header">
        <h2>All Tenants</h2>
    </div>
    <div class="card-body" style="padding: 0;">
        <table class="table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Owner</th>
                    <th>Members</th>
                    <th>Devices</th>
                    <th>Subscription</th>
                    <th>Status</th>
                    <th>Created</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var tenant in Model.Tenants)
                {
                    <tr>
                        <td><strong>@tenant.Name</strong></td>
                        <td>@tenant.OwnerEmail</td>
                        <td>@tenant.MemberCount</td>
                        <td>@tenant.DeviceCount</td>
                        <td>
                            @if (tenant.HasActiveSubscription)
                            {
                                <span class="badge badge-success">@tenant.PlanName</span>
                            }
                            else
                            {
                                <span class="badge badge-warning">No Subscription</span>
                            }
                        </td>
                        <td>
                            @switch (tenant.Status)
                            {
                                case "Active":
                                    <span class="badge badge-success">Active</span>
                                    break;
                                case "OnHold":
                                    <span class="badge badge-warning">On Hold</span>
                                    break;
                                case "Banned":
                                    <span class="badge badge-danger">Banned</span>
                                    break;
                                case "SoftDeleted":
                                    <span class="badge badge-secondary">Soft Deleted</span>
                                    break;
                                default:
                                    <span class="badge badge-secondary">@tenant.Status</span>
                                    break;
                            }
                            @if (!string.IsNullOrEmpty(tenant.StatusReason))
                            {
                                <i class="fas fa-info-circle" title="@tenant.StatusReason"></i>
                            }
                        </td>
                        <td>@tenant.CreatedAt.ToString("MMM d, yyyy")</td>
                        <td class="actions">
                            <button type="button" class="btn btn-sm btn-outline-primary" 
                                    onclick="openStatusModal('@tenant.Id', '@tenant.Status', '@tenant.StatusReason')">
                                Status
                            </button>
                            <a href="/Tenants/Details/@tenant.Id" class="btn btn-secondary btn-sm">View</a>
                        </td>
                    </tr>
                }
                @if (!Model.Tenants.Any())
                {
                    <tr>
                        <td colspan="7" style="text-align: center; color: var(--secondary); padding: 2rem;">
                            No tenants found.
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<!-- Status Modal -->
<div class="modal fade" id="statusModal" tabindex="-1" role="dialog" aria-labelledby="statusModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <form method="post" asp-page-handler="UpdateStatus">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="statusModalLabel">Update Tenant Status</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="hidden" asp-for="TenantId" id="modalTenantId" />
                    
                    <div class="form-group">
                        <label asp-for="NewStatus">Status</label>
                        <select asp-for="NewStatus" id="modalStatus" class="form-control">
                            <option value="Active">Active</option>
                            <option value="OnHold">On Hold (Read Only)</option>
                            <option value="Banned">Banned (No Access)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label asp-for="Reason">Reason</label>
                        <textarea asp-for="Reason" id="modalReason" class="form-control" rows="3" placeholder="Reason for status change..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        function openStatusModal(id, status, reason) {
            $('#modalTenantId').val(id);
            $('#modalStatus').val(status);
            $('#modalReason').val(reason);
            $('#statusModal').modal('show');
        }
    </script>
}
